version: 2.1

jobs:
  build:
    docker:
      - image: cimg/openjdk:8.0.362
    steps:
      - checkout
      - run: ./gradlew clean build
      - run: docker build -t my-image .
      - run: docker login -u $DOCKERHUB_USER -p $DOCKERHUB_PASSWORD
      - run: docker tag my-image $DOCKERHUB_USER/my-image:$CIRCLE_SHA1
      - run: docker push $DOCKERHUB_USER/my-image:$CIRCLE_SHA1